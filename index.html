<!DOCTYPE html>
<html>
    <head>
        <title>
            Snake Game
        </title>
    </head>
    <body>
        <script>
            var body = document.querySelector("body");
            body.style.backgroundColor = "black";

            var borderBox = document.createElement("div");
            borderBox.style.position = "absolute";
            borderBox.style.left = "4vh";
            borderBox.style.top = "4vh";
            borderBox.style.width = "91vh";
            borderBox.style.height = "91vh";
            borderBox.style.backgroundColor = "transparent";
            borderBox.style.border = "4px double white";
            body.appendChild(borderBox);
            // ==================================== Constants ===================================
            const BOX_WIDTH = "5vh";
            const BOX_HEIGHT = "5vh";
            const BOX_BORDER_RADIUS = "10%";
            const BOX_TRANSITION = "top 0.30s, left 0.30s";
            const BOX_TRANSITIONTIMINGFUNCTION = "linear";
            const BOX_BACKGROUND_COLOR = "white";
            const SNAKE_SPEED = 5;
            // ================================= Helper Functions ===============================
            function getValidPosition(pos){
                pos = Math.min(pos, 90);
                pos = Math.max(pos, 5);
                return pos;
            }

            function getNewBox(top,left){
                console.log("Create new Box at "+top+" "+left);
                let box = document.createElement("div");
                box.style.backgroundColor = BOX_BACKGROUND_COLOR;
                box.style.position = "absolute";
                box.style.top = top+"vh";
                box.style.left = left+"vh";
                box.style.width = BOX_WIDTH;
                box.style.height = BOX_HEIGHT;
                box.style.borderRadius = BOX_BORDER_RADIUS;
                box.style.transition = BOX_TRANSITION;
                box.style.transitionTimingFunction = BOX_TRANSITIONTIMINGFUNCTION;
                return box;
            }

            // ================================== Directions ==========================================
            var currentDirection = 1;
            var directions = [  [0,-1],         //left
                                [-1,0],         //up
                                [0, 1],         //right
                                [1, 0]]         //down
            var rotation = [-90, 0, 90, 180];

            // ======================================= Score =====================================
            var Score = document.createElement("div");
            var currentScore = 0;
            Score.style.backgroundColor = "transparent";
            Score.style.position = "absolute";
            Score.innerHTML = "Score : 0";
            Score.style.top = "5vh";
            Score.style.left = "105vh";
            Score.style.color = "white";
            Score.style.fontSize = "5ex";

            body.appendChild(Score);

            function updateScore(score){
                Score.innerHTML = "Score : "+score;
            }
            
            // ======================================== SNAKE ======================================
            var topPos = 50,leftPos = 50;
            var head = document.createElement("div");
            head.style.backgroundColor = BOX_BACKGROUND_COLOR;
            head.style.position = "absolute";
            head.style.top = "50vh";
            head.style.left = "50vh";
            head.style.width = BOX_WIDTH;
            head.style.height = BOX_HEIGHT;
            head.style.borderRadius = BOX_BORDER_RADIUS;
            head.style.transition = BOX_TRANSITION;
            head.style.transitionTimingFunction = BOX_TRANSITIONTIMINGFUNCTION;
            
            var leye = document.createElement("div");
            leye.style.backgroundColor = "red";
            leye.style.position = "absolute";
            leye.style.top = "-5%";
            leye.style.left = "25%";
            leye.style.width="20%";
            leye.style.height="20%";
            leye.style.borderRadius = "45%";

            var reye = document.createElement("div");
            reye.style.backgroundColor = "red";
            reye.style.position = "absolute";
            reye.style.top = "-5%";
            reye.style.right = "25%";
            reye.style.width="20%";
            reye.style.height="20%";
            reye.style.borderRadius = "45%";
            
            head.appendChild(leye);
            head.appendChild(reye);

            body.appendChild(head);

            snake = [];
            snake[0] = head;

            function moveSnake(){
                topPos += directions[currentDirection][0]*SNAKE_SPEED;
                leftPos += directions[currentDirection][1]*SNAKE_SPEED;

                topPos = getValidPosition(topPos);
                leftPos = getValidPosition(leftPos);

                if(topPos == appleTopPos && leftPos == appleLeftPos){
                    console.log("Caught Apple");
                    placeApple();
                    currentScore += 10;
                    updateScore(currentScore);
                    snake[snake.length] = getNewBox(snake[snake.length-1].style.top,snake[snake.length-1].style.left);
                    body.append(snake[snake.length-1]);
                }
                for(let i=snake.length-1 ; i>0 ;i--){
                    snake[i].style.top = snake[i-1].style.top;
                    snake[i].style.left = snake[i-1].style.left;
                }
                snake[0].style.transform = "rotate("+rotation[currentDirection]+"deg)";
                snake[0].style.top = topPos+"vh";
                snake[0].style.left = leftPos+"vh";

            }

            // ====================================== Apple =======================================
            var appleBox = document.createElement("div");
            appleBox.style.position = "absolute";
            appleBox.style.width = "5vh";
            appleBox.style.height = "5vh";
            appleBox.style.backgroundColor = "red";
            appleBox.style.borderRadius = "50%";
            var appleTopPos = 0, appleLeftPos = 0;
            placeApple();

            body.appendChild(appleBox);

            function placeApple(){
                appleTopPos = getValidPosition(Math.floor((Math.random()*100)/5)*5);
                appleLeftPos = getValidPosition(Math.floor((Math.random()*100)/5)*5);
                console.log("Placing Apple to "+appleTopPos+" "+appleLeftPos);
                appleBox.style.top = appleTopPos+"vh";
                appleBox.style.left = appleLeftPos+"vh";
            }

            
            // ================================== Event Listeners ======================================
            document.addEventListener("keydown", (event)=>{
                // console.log(event.key+" "+event.code);
                switch(event.code){
                    case "ArrowUp":
                        if(currentDirection == 0 || currentDirection == 2){
                            currentDirection = 1;
                        }
                        break;
                    case "ArrowDown":
                        if(currentDirection == 0 || currentDirection == 2){
                            currentDirection = 3;
                        }
                        break;
                    case "ArrowLeft":
                        if(currentDirection == 1 || currentDirection == 3){
                            currentDirection = 0;
                        }
                        break;
                    case "ArrowRight":
                        if(currentDirection == 1 || currentDirection == 3){
                            currentDirection = 2;
                        }
                        break;
                    default:
                        moveSnake();
                        break;
                }
            });

            // ===================================== Game Loop ==========================================
            setInterval(moveSnake, 300);
        </script>
    </body>
</html>